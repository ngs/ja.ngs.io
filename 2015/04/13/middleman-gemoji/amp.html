<!DOCTYPE html>
<html âš¡ itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <title>middleman-blog ã§æ‰‹ã£å–ã‚Šæ—©ãçµµæ–‡å­—å¯¾å¿œã‚’ã™ã‚‹:full_moon_with_face:</title>
    <link itemprop="mainEntityOfPage" rel="canonical" href="https://ja.ngs.io/2015/04/13/middleman-gemoji/">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-custom>
      body {
        background-color: white;
        color: #404040;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
      }
      amp-img {
        background-color: gray;
      }

      .container {
        padding: 0 8px;
      }

      @media (min-width: 480px) {
        .container {
          padding: 0 16px;
        }
      }

    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article class="container">
      <h1 itemprop="headline">middleman-blog ã§æ‰‹ã£å–ã‚Šæ—©ãçµµæ–‡å­—å¯¾å¿œã‚’ã™ã‚‹:full_moon_with_face:</h1>
      <h2 itemprop="author" itemscope itemtype="https://schema.org/Person">
        <span itemprop="name">é•·ç€¬ æ•¦å²</span>
      </h2>
      <time itemprop="datePublished" datetime="2015-04-13T11:30:00+00:00">2015-04-13 11:30</time>
      <meta itemprop="description" content="middleman-blog ã§çµµæ–‡å­—ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨ã€æ—¢å­˜ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä¸Šæ‰‹ãçµ„ã¿è¾¼ã‚ãªã‹ã£ãŸã®ã§ã€æ‰‹ã£å–ã‚Šæ—©ãã€è‡ªåˆ†ã§æ‹¡å¼µã—ã¾ã—ãŸ:hammer:"></meta>
      <div class="hidden article-metadata"><meta content="middleman-blog ã§çµµæ–‡å­—ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨ã€æ—¢å­˜ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä¸Šæ‰‹ãçµ„ã¿è¾¼ã‚ãªã‹ã£ãŸã®ã§ã€æ‰‹ã£å–ã‚Šæ—©ãã€è‡ªåˆ†ã§æ‹¡å¼µã—ã¾ã—ãŸğŸ”¨" itemprop="headline" /><div itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><meta content="2015-04-13-middleman-gemoji/emojis.png" itemprop="url" /><meta content="1400" itemprop="width" /><meta content="1020" itemprop="height" /></div><div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta content="Atsushi Nagase" itemprop="name" /><div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject"><meta content="https://ja.ngs.io/images/amp-logo.png" itemprop="url" /><meta content="600" itemprop="width" /><meta content="60" itemprop="height" /></div></div><meta content="2015-04-13T11:30:00" itemprop="dateModified" /></div>
      <p><a href="https://github.com/middleman/middleman-blogA">middleman-blog</a> ã§ãƒ–ãƒ­ã‚°ã‚’æ›¸ã„ã¦ã„ã¦ã€çµµæ–‡å­—å¯¾å¿œã‚’ã—ã‚ˆã†ã¨ã€æ—¢å­˜ã® Middleman ãƒ—ãƒ©ã‚°ã‚¤ãƒ³: <a href="https://github.com/stny/middleman-emoji">middleman-emoji</a>, <a href="https://github.com/yterajima/middleman-gemoji">middleman-gemoji</a> ã‚’è©¦ã—ã¦ã¿ãŸã®ã§ã™ãŒã€ã©ã¡ã‚‰ã‚‚ã€ç¾åœ¨ã® <a href="https://github.com/middleman/middleman-blogA">middleman-blog</a> å®‰å®šç‰ˆ: v3.5.3 ã‹ã‚‰ç°¡å˜ã«çµ„ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚(ä¾å­˜ã—ã¦ã„ã‚‹ Middleman Core ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ 3.3 ã«ãªã£ã¦ã„ãŸã®ã‚’ 3.2 ã«ç·©ã‚ãŸã‚Šã‚‚ã—ã¦ã¿ã¾ã—ãŸã€‚)</p>

<p>ã•ã‚‰ã«ã€Middleman ã‚’ 3.3 ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ã¿ãŸã®ã§ã™ãŒã€æ—¢å­˜ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã«äº’æ›æ€§ãŒãªãã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã€ãƒ“ãƒ«ãƒ‰ã§ããšã€è§£æ±ºã™ã‚‹ã®ã«å·¥æ•°ã‚’è¦ã—ãã†ã ã£ãŸã®ã§ã€è‡ªåˆ†ã§æ‹¡å¼µã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>



<h2 id="part-78410b5fd53d411b">ã‚„ã£ãŸã“ã¨</h2>

<ul>
<li>Markdown æœ¬æ–‡ã§ <code>:emoji_name:</code> ã®æ§˜ãªã€ã‚³ãƒ­ãƒ³ã§å›²ã‚ã‚ŒãŸéƒ¨åˆ†ã‚’ <code>&lt;img&gt;</code> ã‚¿ã‚°ã§ã€GitHub ã® CDN ã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ Emoji ã‚’è¡¨ç¤ºã™ã‚‹æ§˜ç½®æ›ã™ã‚‹ã€‚
</li><li>View ã‹ã‚‰ <code>emojify(content, mode)</code> ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ä½¿ãˆã‚‹æ§˜ã«ã™ã‚‹

<ul>
<li><code>mode == :row</code> ã®ã¨ãã€<a href="http://ja.wikipedia.org/wiki/Unicode6.0%E3%81%AE%E6%90%BA%E5%B8%AF%E9%9B%BB%E8%A9%B1%E3%81%AE%E7%B5%B5%E6%96%87%E5%AD%97%E3%81%AE%E4%B8%80%E8%A6%A7">Unicode æ¨™æº–çµµæ–‡å­—</a> ã¯ Unicode çµµæ–‡å­—ã§ã€ãã‚Œä»¥å¤–ã¯ç©ºç™½ã‚’è¿”ã™æ§˜ã«ã™ã‚‹
</li></ul>
</li></ul>

<h2 id="gemoji">gemoji</h2>

<p>çµµæ–‡å­—ã®è¾æ›¸ã¯ã€GitHub ãŒå…¬é–‹ã—ã¦ã„ã‚‹ã€<a href="https://github.com/github/gemoji">gemoji</a> ã‚’ä½¿ã„ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'gemoji'</span><span class="p">,</span> <span class="s1">'~&gt; 2.1'</span>
</code></pre></div>
<h3 id="lib-emoji_helper-rb">lib/emoji_helper.rb</h3>

<p>Helper ã¯ã€<a href="https://github.com/github/gemoji#example-rails-helper">gemoji ã® README</a> ã«ã‚ã‚‹ã‚‚ã®ã‚’æµç”¨ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">module</span> <span class="nn">EmojiHelper</span>
  <span class="k">def</span> <span class="nf">emojify</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
    <span class="n">content</span><span class="p">.</span><span class="nf">to_str</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/:([\w+-]+):/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">match</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">emoji</span> <span class="o">=</span> <span class="no">Emoji</span><span class="p">.</span><span class="nf">find_by_alias</span><span class="p">(</span><span class="vg">$1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="ss">:raw</span>
          <span class="n">emoji</span><span class="p">.</span><span class="nf">raw</span>
        <span class="k">else</span>
          <span class="sx">%(&lt;img alt="#$1" src="https://assets-cdn.github.com/images/icons/emoji/#{emoji.image_filename}?v5" class="gemoji"&gt;)</span>
        <span class="k">end</span>
      <span class="k">else</span>
        <span class="n">match</span>
      <span class="k">end</span>
    <span class="k">end</span> <span class="k">if</span> <span class="n">content</span><span class="p">.</span><span class="nf">present?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="markdown">Markdown æœ¬æ–‡ã®ç½®æ›</h2>

<p>å…ƒã€… <a href="https://github.com/middleman/middleman/blob/v3-stable/middleman-core/lib/middleman-core/renderers/redcarpet.rb">Redcarpet ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼</a> ã‚’ä½¿ç”¨ã—ã¦ã„ãŸã‚‚ã®ã‚’ã€<code>Middleman::Renderers::RedcarpetTemplate</code> ã‚’ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã—ãŸã€ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§ã€Markdown ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ä¸Šæ›¸ãã—ã¾ã™ã€‚</p>

<h3 id="lib-middleman-renderers-custom-rb">lib/middleman/renderers/custom.rb</h3>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'middleman-core/renderers/redcarpet'</span>
<span class="nb">require</span> <span class="s1">'gemoji'</span>
<span class="k">module</span> <span class="nn">Middleman</span>
  <span class="k">module</span> <span class="nn">Renderers</span>
    <span class="k">class</span> <span class="nc">CustomTemplate</span> <span class="o">&lt;</span> <span class="no">RedcarpetTemplate</span><span class="p">;</span> <span class="k">end</span>
    <span class="k">module</span> <span class="nn">CustomRenderer</span>
      <span class="kp">include</span> <span class="o">::</span><span class="no">Redcarpet</span><span class="o">::</span><span class="no">Render</span><span class="o">::</span><span class="no">SmartyPants</span>
      <span class="kp">include</span> <span class="o">::</span><span class="no">EmojiHelper</span>
      <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">full_document</span><span class="p">)</span>
        <span class="n">emojify</span> <span class="n">full_document</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="o">::</span><span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span><span class="o">::</span><span class="no">MiddlemanRedcarpetHTML</span><span class="p">.</span><span class="nf">send</span> <span class="ss">:include</span><span class="p">,</span> <span class="o">::</span><span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span><span class="o">::</span><span class="no">CustomRenderer</span>
</code></pre></div>
<h3 id="config-rb">config.rb</h3>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'./lib/middleman/emoji_helper'</span>
<span class="nb">require</span> <span class="s1">'./lib/middleman/renderers/custom'</span>

<span class="n">set</span> <span class="ss">:markdown_engine</span><span class="p">,</span> <span class="ss">:custom</span>
<span class="n">set</span> <span class="ss">:markdown_engine_prefix</span><span class="p">,</span> <span class="o">::</span><span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span>
<span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="ss">:fenced_code_blocks</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:smartypants</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
  <span class="ss">:autolink</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:tables</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:with_toc_data</span> <span class="o">=&gt;</span> <span class="kp">true</span>

<span class="n">ready</span> <span class="k">do</span>
  <span class="o">::</span><span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span><span class="o">::</span><span class="no">MiddlemanRedcarpetHTML</span><span class="p">.</span><span class="nf">middleman_app</span> <span class="o">=</span> <span class="nb">self</span>
<span class="k">end</span>
<span class="n">helpers</span> <span class="k">do</span>
  <span class="kp">include</span> <span class="no">EmojiHelper</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="meta-title"><code>&lt;meta&gt;</code>, <code>&lt;title&gt;</code> è¦ç´ ã®ç½®æ›</h2>

<p><code>&lt;meta&gt;</code>, <code>&lt;title&gt;</code> è¦ç´  ã¯ <code>&lt;img&gt;</code> ã‚¿ã‚°ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ããªã„ã®ã§ã€<code>emojify</code> ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã®2ç•ªç›®ã®å¼•æ•°ã‚’ <code>:raw</code> ã«ã—ã¦ã€Unicode ã®çµµæ–‡å­—ã‚’ãã®ã¾ã¾ç½®æ›ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight slim"><code><span class="nt">title</span><span class="w"> </span><span class="p">=</span> <span class="n">emojify</span> <span class="n">current_article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="ss">:raw</span>
</code></pre></div>
<p><amp-img src="/images/2015-04-13-middleman-gemoji/unicode-replaced.png" layout="responsive" width="1100" height="227"></amp-img></p>

<p><a href="http://ja.wikipedia.org/wiki/Unicode6.0%E3%81%AE%E6%90%BA%E5%B8%AF%E9%9B%BB%E8%A9%B1%E3%81%AE%E7%B5%B5%E6%96%87%E5%AD%97%E3%81%AE%E4%B8%80%E8%A6%A7">Unicode æ¨™æº–çµµæ–‡å­—</a> ã§ãªã„å ´åˆã«ã¯ã€ç©ºç™½ã«ç½®æ›ã—ã¾ã™ã€‚</p>

<h2 id="part-21c8fe43be13907a">ç„¡äº‹ç½®æ›ã§ãã¾ã—ãŸ <amp-img src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f44c.png?v5" layout="fixed" width="128" height="128"></amp-img></h2>

<p><amp-img src="/images/2015-04-13-middleman-gemoji/emojis.png" layout="responsive" width="1400" height="1020"></amp-img></p>

    </article>
  </body>
</html>
