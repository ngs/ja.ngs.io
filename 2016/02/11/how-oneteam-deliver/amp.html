<!DOCTYPE html>
<html âš¡ itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <title>Oneteam ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ + é…ä¿¡è‡ªå‹•åŒ– #meguroes</title>
    <link itemprop="mainEntityOfPage" rel="canonical" href="https://ja.ngs.io/2016/02/11/how-oneteam-deliver/">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-custom>
      body {
        background-color: white;
        color: #404040;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
      }
      amp-img {
        background-color: gray;
      }

      .container {
        padding: 0 8px;
      }

      @media (min-width: 480px) {
        .container {
          padding: 0 16px;
        }
      }

    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article class="container">
      <h1 itemprop="headline">Oneteam ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ + é…ä¿¡è‡ªå‹•åŒ– #meguroes</h1>
      <h2 itemprop="author" itemscope itemtype="https://schema.org/Person">
        <span itemprop="name">é•·ç€¬ æ•¦å²</span>
      </h2>
      <time itemprop="datePublished" datetime="2016-02-11T09:30:00+00:00">2016-02-11 09:30</time>
      <meta itemprop="description" content="Meguro.es ã§ç™ºè¡¨ã•ã›ã¦ã„ãŸã ã„ãŸã€Electron ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ + é…ä¿¡è‡ªå‹•åŒ– ã«ã¤ã„ã¦ ã®è©³ç´°"></meta>
      <div class="hidden article-metadata"><meta content="Meguro.es ã§ç™ºè¡¨ã•ã›ã¦ã„ãŸã ã„ãŸã€Electron ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ + é…ä¿¡è‡ªå‹•åŒ– ã«ã¤ã„ã¦ ã®è©³ç´°" itemprop="headline" /><div itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><meta content="2016-02-11-how-oneteam-deliver/oneteam.jpg" itemprop="url" /><meta content="1200" itemprop="width" /><meta content="630" itemprop="height" /></div><div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta content="Atsushi Nagase" itemprop="name" /><div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject"><meta content="https://ja.ngs.io/images/amp-logo.png" itemprop="url" /><meta content="600" itemprop="width" /><meta content="60" itemprop="height" /></div></div><meta content="2016-02-11T09:30:00" itemprop="dateModified" /></div>
      <p><amp-img src="/images/2016-02-11-how-oneteam-deliver/oneteam.jpg" layout="responsive" width="1200" height="630"></amp-img></p>

<p>2016-02-10ã€ã‚¢ãƒ«ã‚³ã‚¿ãƒ¯ãƒ¼ã«ã‚ã‚‹ãƒ‰ãƒªã‚³ãƒ ã•ã‚“ã§é–‹å‚¬ã•ã‚ŒãŸ <a href="http://meguroes.connpass.com/event/25018/">Meguro.es</a> ã§ã€å¼Šç¤¾ <a href="https://one-team.com/ja/products/">Oneteam</a> ãŒè¡Œã£ã¦ã„ã‚‹ã€<a href="http://electron.atom.io/">Electron</a> ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ + é…ä¿¡è‡ªå‹•åŒ–ã«ã¤ã„ã¦ã€ç™ºè¡¨ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚</p>

<p>ã‚¹ãƒ©ã‚¤ãƒ‰ã¯ <a href="/2016/02/11/how-oneteam-deliver/#embed-slide">ã“ã®è¨˜äº‹ã®æœ€å¾Œ</a>ã«åŸ‹ã‚è¾¼ã‚“ã§ã„ã¾ã™ã€‚</p>

<p>ã‚¹ãƒ©ã‚¤ãƒ‰ã ã‘ã ã¨æ´»ç”¨ã—è¾›ã„ã¨æ€ã†ã®ã§ã€Web å´ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚‚å«ã‚ã¦ã€ã“ã¡ã‚‰ã§è©³ã—ãæ²è¼‰ã—ã¾ã™ã€‚</p>



<h2 id="part-1c867e30345085b0">æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</h2>

<p><amp-img src="/images/2016-02-11-how-oneteam-deliver/techstack.png" layout="responsive" width="2270" height="2000"></amp-img></p>

<p><a href="https://one-team.com/ja/products/">Oneteam</a> ã¯ã€ä»¥ä¸‹ã®æ§˜ãªæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã§é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚</p>

<ul>
<li>Frontend

<ul>
<li>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: <a href="https://facebook.github.io/react/">React.js</a>, <a href="https://facebook.github.io/flux/">Flux</a>
</li><li>WebSocket SaaS: <a href="https://pusher.com/">Pusher</a>
</li><li>ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«: <a href="https://webpack.github.io/">Webpack</a>
</li><li>Web ç‰ˆ
</li><li>ãƒ¡ã‚¤ãƒ³ HTML: <a href="http://nginx.org/">nginx</a> + <a href="https://aws.amazon.com/jp/ecs/">Amazon EC2 Container Service</a>
</li><li>ãã®ä»–è³‡æ: Amazon S3 + CloudFront
</li><li>Desktop ç‰ˆ (Windows/Mac)
</li><li><a href="http://electron.atom.io/">Electron</a>
</li></ul>
</li><li>Backend

<ul>
<li>Scala (<a href="http://spray.io/">Spray</a> + <a href="http://akka.io/">Akka</a>)
</li><li><a href="https://aws.amazon.com/jp/ecs/">Amazon EC2 Container Service</a>
</li><li><a href="https://aws.amazon.com/jp/rds/aurora/">Amazon RDS for Aurora</a>
</li><li>ãªã©ãªã©
</li></ul>
</li></ul>

<p>ã“ã‚Œã‚‰ã®ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»é…å¸ƒã®ä¸€é€£ã®ä½œæ¥­ã¯ã€èª°ã§ã‚‚æ‰‹é–“ç„¡ãç€æ‰‹ã§ãã‚‹æ§˜ã«ã™ã‚‹ãŸã‚ã€<a href="https://circleci.com/">CircleCI</a> ã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§è‡ªå‹•åŒ–ã—ã¦ã„ã¾ã™ã€‚</p>

<h2 id="ci">CI ã®æµã‚Œ</h2>

<h3 id="1">1. ãƒ“ãƒ«ãƒ‰</h3>

<p>ãƒ“ãƒ«ãƒ‰ã¯è‡³ã£ã¦ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚</p>

<h4 id="1-1-webpack-jade-index-html">1.1. Webpack + Jade (<code>index.html</code>) ãƒ“ãƒ«ãƒ‰</h4>
<div class="highlight"><pre class="highlight shell"><code>jade src/templates/index.jade <span class="nt">--out</span> build
webpack <span class="nt">--config</span> config/webpack.config.babel.js
</code></pre></div>
<h4 id="1-2-docker-image">1.2. Docker Image ãƒ“ãƒ«ãƒ‰</h4>

<p><code>index.html</code> ã®ã¿ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ã€å¿…è¦æœ€ä½é™ã®æ§‹æˆã§ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code>FROM ubuntu:14.04
MAINTAINER Atsushi Nagase&lt;ngs@oneteam.co.jp&gt;

RUN apt-get update <span class="nt">-y</span> <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> software-properties-common python-software-properties
RUN apt-add-repository <span class="nt">-y</span> ppa:nginx/stable
RUN apt-get update <span class="nt">-y</span> <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> curl supervisor nginx

RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /var/www/app/script
RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /var/www/app/public
RUN <span class="nb">echo</span> &lt;%<span class="o">=</span> <span class="sb">`</span><span class="nb">cat </span>files/etc/supervisor/supervisord.conf<span class="sb">`</span>.inspect %&gt; <span class="o">&gt;</span> /etc/supervisor/supervisord.conf
RUN <span class="nb">echo</span> &lt;%<span class="o">=</span> <span class="sb">`</span><span class="nb">cat </span>files/etc/supervisor/conf.d/nginx.conf<span class="sb">`</span>.inspect %&gt; <span class="o">&gt;</span> /etc/supervisor/conf.d/nginx.conf
RUN <span class="nb">echo</span> &lt;%<span class="o">=</span> <span class="sb">`</span><span class="nb">cat </span>files/etc/nginx/nginx.conf<span class="sb">`</span>.inspect.gsub<span class="o">(</span>/<span class="se">\$</span>/, <span class="s1">'\\$'</span><span class="o">)</span> %&gt; <span class="o">&gt;</span> /etc/nginx/nginx.conf
RUN <span class="nb">echo</span> &lt;%<span class="o">=</span> <span class="sb">`</span><span class="nb">cat</span> ../build/index.html<span class="sb">`</span>.inspect %&gt; <span class="o">&gt;</span> /var/www/app/public/index.html
ADD files/public/favicon.ico /var/www/app/public/favicon.ico

CMD <span class="o">[</span><span class="s2">"/usr/bin/supervisord"</span>, <span class="s2">"-n"</span><span class="o">]</span>
</code></pre></div><div class="highlight"><pre class="highlight shell"><code><span class="nb">cd </span>docker <span class="o">&amp;&amp;</span> erb Dockerfile.erb <span class="o">&gt;</span> Dockerfile
docker build <span class="nt">-t</span> <span class="nv">$TARGET</span> <span class="nb">.</span>
</code></pre></div>
<h2 id="2">2. ãƒ†ã‚¹ãƒˆ</h2>

<ul>
<li><a href="https://facebook.github.io/jest/">jest</a> ã§å˜ä½“ãƒ†ã‚¹ãƒˆ
</li><li><a href="http://serverspec.org/">Serverspec</a> ã§ Docker Image ã‚’ãƒ†ã‚¹ãƒˆ
</li></ul>

<h3 id="3-web">3. Web ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤</h3>

<h4 id="3-1-docker-image-push">3.1. Docker Image Push</h4>

<p>Docker Hub ã« <code>oneteam/our-ubuntu:comuque-web-production-b1234</code> ã®æ§˜ãªã€CI ãƒ“ãƒ«ãƒ‰ç•ªå·ã‚’ä½¿ã£ãŸã‚¿ã‚°åã§ Push ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code>docker push <span class="s2">"</span><span class="k">${</span><span class="nv">DOCKER_REPO</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">TAG_WEB</span><span class="k">}</span><span class="s2">-production-b</span><span class="k">${</span><span class="nv">CIRCLE_BUILD_NUM</span><span class="k">}</span><span class="s2">"</span>
</code></pre></div>
<h4 id="3-2-s3-index-html">3.2. S3 ãƒã‚±ãƒƒãƒˆã« <code>index.html</code> ä»¥å¤–ã®è³‡æã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
<div class="highlight"><pre class="highlight javascript"><code><span class="cm">/*eslint no-process-env: 0 no-console: 0*/</span>
<span class="k">import</span> <span class="nx">s3</span> <span class="k">from</span> <span class="s2">"s3"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">path</span> <span class="k">from</span> <span class="s2">"path"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ProgressBar</span> <span class="k">from</span> <span class="s2">"progress"</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">s3</span><span class="p">.</span><span class="nx">createClient</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">uploader</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">uploadDir</span><span class="p">({</span>
  <span class="na">localDir</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">"../build/assets"</span><span class="p">),</span>
  <span class="na">deleteRemoved</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">s3Params</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">Bucket</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">S3_BUCKET</span><span class="p">,</span>
    <span class="na">ACL</span><span class="p">:</span> <span class="s2">"public-read"</span><span class="p">,</span>
    <span class="na">Prefix</span><span class="p">:</span> <span class="s2">"assets/"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="kd">let</span> <span class="nx">barCache</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">let</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">current</span><span class="p">,</span> <span class="nx">total</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">barCache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span>
    <span class="nx">barCache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span>
    <span class="k">new</span> <span class="nx">ProgressBar</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> [:bar] :percent (:current/:total)`</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">total</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">width</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="p">}));</span>
  <span class="nx">b</span><span class="p">.</span><span class="nx">total</span> <span class="o">=</span> <span class="nx">total</span><span class="p">;</span>
  <span class="nx">b</span><span class="p">.</span><span class="nx">curr</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
  <span class="nx">b</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">uploader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"error"</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">uploader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"progress"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uploader</span><span class="p">.</span><span class="nx">doneMd5</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">(</span><span class="s2">"md5"</span><span class="p">,</span> <span class="nx">uploader</span><span class="p">.</span><span class="nx">progressMd5Amount</span><span class="p">,</span> <span class="nx">uploader</span><span class="p">.</span><span class="nx">progressMd5Total</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">uploader</span><span class="p">.</span><span class="nx">progressTotal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">(</span><span class="s2">"uploading"</span><span class="p">,</span> <span class="nx">uploader</span><span class="p">.</span><span class="nx">progressAmount</span><span class="p">,</span> <span class="nx">uploader</span><span class="p">.</span><span class="nx">progressTotal</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">uploader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">done uploading"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="3-3-ecs">3.3. ECS ã‚¿ã‚¹ã‚¯æ›´æ–°</h4>

<p>ã“ã®ãƒ“ãƒ«ãƒ‰ã§ Push ã—ãŸã‚¿ã‚°åã‚’å‚ç…§ã™ã‚‹æ§˜ã€ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã—ã¾ã™ã€‚</p>

<p><code>ecs-task-definitions/(production|staging)-service.json.erb</code> ã®æŠœç²‹</p>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"family"</span><span class="p">:</span> <span class="s2">"comuque-frontend-&lt;%= ENV['ENV_NAME'] %&gt;"</span><span class="p">,</span>
  <span class="s2">"containerDefinitions"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"image"</span><span class="p">:</span> <span class="s2">"&lt;%= ENV['DOCKER_REPO'] %&gt;:comuque-web-&lt;%= ENV['ENV_NAME'] %&gt;-b&lt;%= ENV['CIRCLE_BUILD_NUM'] %&gt;"</span><span class="p">,</span>
      <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"&lt;%= ENV['CONTAINER_NAME'] %&gt;"</span><span class="p">,</span>
      <span class="s2">"cpu"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">"memory"</span><span class="p">:</span> <span class="mi">1638</span><span class="p">,</span>
      <span class="s2">"essential"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"portMappings"</span><span class="p">:</span> <span class="p">[{</span> <span class="s2">"hostPort"</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">"containerPort"</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="nx">ENV</span><span class="p">[</span><span class="s1">'CONTAINER_PORT'</span><span class="p">]</span> <span class="o">%&gt;</span><span class="p">,</span> <span class="s2">"protocol"</span><span class="p">:</span> <span class="s2">"tcp"</span> <span class="p">}],</span>
      <span class="s2">"environment"</span><span class="p">:</span> <span class="p">[],</span>
      <span class="s2">"essential"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
  <span class="p">],</span> <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>ERb ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦</p>
<div class="highlight"><pre class="highlight shell"><code>erb ecs-task-definitions/<span class="k">${</span><span class="nv">ENV_NAME</span><span class="k">}</span><span class="nt">-service</span>.json.erb <span class="o">&gt;</span> .ecs-task-definition.json
</code></pre></div>
<p>Task Definition ã‚’æ›´æ–°ã—ã€ãƒªãƒ“ã‚¸ãƒ§ãƒ³ ID ã‚’ <code>jq</code> ã§å–å¾—ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">TASK_DEFINITION_JSON</span><span class="o">=</span><span class="k">$(</span>aws ecs register-task-definition <span class="se">\</span>
  <span class="nt">--family</span> <span class="nv">$TASK_FAMILY</span> <span class="se">\</span>
  <span class="nt">--cli-input-json</span> <span class="s2">"file://</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/.ecs-task-definition.json"</span><span class="k">)</span>
<span class="nv">TASK_REVISION</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$TASK_DEFINITION_JSON</span> | jq .taskDefinition.revision<span class="k">)</span>
</code></pre></div>
<p>æ¬¡ã« Service ã‚’æ›´æ–°ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code>aws ecs update-service <span class="se">\</span>
  <span class="nt">--cluster</span> <span class="k">${</span><span class="nv">CLUSTER</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--service</span> <span class="k">${</span><span class="nv">SERVICE_NAME</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--task-definition</span> <span class="k">${</span><span class="nv">TASK_FAMILY</span><span class="k">}</span>:<span class="k">${</span><span class="nv">TASK_REVISION</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--desired-count</span> <span class="k">${</span><span class="nv">DESIRED_COUNT</span><span class="k">}</span>
</code></pre></div>
<h3 id="4-desktop">4. Desktop ç‰ˆé…å¸ƒ</h3>

<p>Desktop ç‰ˆã®ãƒ“ãƒ«ãƒ‰ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ãƒ³ã‚’è¡Œã† <code>codesign</code> ã‚³ãƒãƒ³ãƒ‰ãªã©ã€Xcode ã«ä»˜å±ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦ãªã®ã§ã€CircleCI ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ãƒ†ãƒŠã® Ubuntu ä¸Šã§ã¯è¡Œãˆã¾ã›ã‚“ã€‚</p>

<p>ãã®ãŸã‚ã€ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ã€ä¸€æ—¦åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã« Push ã—ã¦ã€iOS ã‚¢ãƒ—ãƒªãªã©ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã®ã€<a href="https://circleci.com/docs/ios">Darwin ã‚³ãƒ³ãƒ†ãƒŠ</a>ä¸Šã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code>git add <span class="nt">-A</span> build <span class="o">&amp;&amp;</span> <span class="nb">cd </span>build
git push <span class="nt">--force</span> <span class="nv">$YET_ANOTHER_GIT_REPO</span> <span class="nv">$CIRCLE_BRANCH</span>
</code></pre></div>
<p>ä»¥ä¸‹ã€Darwin ã‚³ãƒ³ãƒ†ãƒŠã§è¡Œã£ã¦ã„ã‚‹ãƒ“ãƒ«ãƒ‰å‡¦ç†ã§ã™</p>

<h4 id="4-1">4.1. è¨¼æ˜æ›¸ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h4>

<p>è¨¼æ˜æ›¸ã®é¡ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚‹ã®ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šè‰¯ããªã„ã®ã§ã€<a href="https://ja.ngs.io/2015/03/24/circleci-ios/#éµã¨è¨¼æ˜æ›¸ã®èª­ã¿è¾¼ã¿">iOS ã®ãƒ“ãƒ«ãƒ‰ã§è¡Œã£ã¦ã„ãŸ</a>ã®ã¨åŒæ§˜ã«ã€CircleCI ã®ç’°å¢ƒå¤‰æ•°ã«æ ¼ç´ã—ã€Keychain ã«å–ã‚Šè¾¼ã¿ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">DIR</span><span class="o">=</span>tmp/certs
<span class="nv">KEYCHAIN</span><span class="o">=</span><span class="nv">$HOME</span>/Library/Keychains/circle.keychain
<span class="nv">KEYCHAIN_PASSWORD</span><span class="o">=</span><span class="sb">`</span>openssl rand <span class="nt">-base64</span> 48<span class="sb">`</span>
<span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$DIR</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$DIR</span>
<span class="nb">echo</span> <span class="nv">$APPLE_AUTHORITY_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/apple.cer
<span class="nb">echo</span> <span class="nv">$APPLE_ROOT_CA_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/apple-root-ca.cer
<span class="nb">echo</span> <span class="nv">$DISTRIBUTION_KEY_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/dist.p12
<span class="nb">echo</span> <span class="nv">$DISTRIBUTION_CERTIFICATE_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/dist.cer
<span class="nb">echo</span> <span class="nv">$INSTALLER_KEY_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/installer.p12
<span class="nb">echo</span> <span class="nv">$INSTALLER_CERTIFICATE_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/installer.cer
<span class="nb">echo</span> <span class="nv">$DEVELOPER_KEY_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/developer.p12
<span class="nb">echo</span> <span class="nv">$DEVELOPER_CERTIFICATE_BASE64</span> | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> <span class="nv">$DIR</span>/developer.cer
security create-keychain <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$KEYCHAIN_PASSWORD</span><span class="s2">"</span> circle.keychain
security import <span class="nv">$DIR</span>/apple.cer <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/apple-root-ca.cer <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/dist.cer  <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/dist.p12  <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-P</span> <span class="s2">"</span><span class="nv">$KEY_PASSWORD</span><span class="s2">"</span> <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/installer.cer  <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/installer.p12  <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-P</span> <span class="s2">"</span><span class="nv">$KEY_PASSWORD</span><span class="s2">"</span> <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/developer.cer  <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-A</span>
security import <span class="nv">$DIR</span>/developer.p12  <span class="nt">-k</span> <span class="nv">$KEYCHAIN</span> <span class="nt">-T</span> /usr/bin/codesign <span class="nt">-P</span> <span class="s2">"</span><span class="nv">$KEY_PASSWORD</span><span class="s2">"</span> <span class="nt">-A</span>
security list-keychain <span class="nt">-s</span> <span class="nv">$KEYCHAIN</span>
security unlock-keychain <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$KEYCHAIN_PASSWORD</span><span class="s2">"</span> <span class="nv">$KEYCHAIN</span>
<span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$DIR</span>
</code></pre></div>
<h4 id="4-2-homebrew">4.2. Homebrew ã§å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4>

<p>Electron ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã«ã¯ã€Homebrew ã§ä»¥ä¸‹ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

<ul>
<li><a href="http://www.xquartz.org/">XQuartz</a>
</li><li><a href="https://nodejs.org/">Node.js</a>
</li><li><a href="https://www.winehq.org/">Wine</a>
</li><li><a href="http://nsis.sourceforge.net/Docs/Chapter3.html">MakeNSIS</a>
</li></ul>
<div class="highlight"><pre class="highlight shell"><code>brew <span class="nb">install </span>Caskroom/cask/xquartz nodenv wine makensis
nodenv <span class="nb">install </span>v4.1.0 <span class="o">&amp;&amp;</span> nodenv global v4.1.0
</code></pre></div>
<p>ãŸã ã—ã€ã“ã‚Œã‚’ã¾ã˜ã‚ã«è¡Œã†ã¨ã€30 åˆ†ä»¥ä¸Š Dependencies ã®ã¨ã“ã‚ã§æ™‚é–“ã‚’ä½¿ã£ã¦ã—ã¾ã„ã¾ã™ã€‚</p>

<p><amp-img src="/images/2016-02-11-how-oneteam-deliver/ci-screen1.png" layout="responsive" width="992" height="195"></amp-img></p>

<p>ãã®ãŸã‚ã€Homebrew ã® <code>/usr/local/Celler</code> ã¨ nodenv ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ Tarball ã§å›ºã‚ã¦ã€S3 ãƒã‚±ãƒƒãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nb">cd</span> /usr/local <span class="o">&amp;&amp;</span> cvfz <span class="nv">$CIRCLE_ARTIFACTS</span>/HomebrewCellar.tgz Celler
nodenv <span class="nb">install </span>v4.1.0 <span class="o">&amp;&amp;</span> nodenv global v4.1.0
npm <span class="nb">install</span> <span class="nt">-g</span> electron-builder electron-packager <span class="o">&amp;&amp;</span> nodenv rehash
<span class="nb">cd</span> /usr/local <span class="o">&amp;&amp;</span> <span class="nb">tar </span>cvfz <span class="nv">$CIRCLE_ARTIFACTS</span>/nodenv.tgz nodenv
aws s3 <span class="nb">cp</span> <span class="nv">$CIRCLE_ARTIFACTS</span>/HomebrewCellar.tgz <span class="s2">"s3://</span><span class="nv">$S3_BUCKET</span><span class="s2">/HomebrewCellar.tgz"</span> <span class="nt">--acl</span> public-read
aws s3 <span class="nb">cp</span> <span class="nv">$CIRCLE_ARTIFACTS</span>/nodenv.tgz <span class="s2">"s3://</span><span class="nv">$S3_BUCKET</span><span class="s2">/nodenv.tgz"</span> <span class="nt">--acl</span> public-read
</code></pre></div>
<p>ä»¥é™ã€ãã‚Œã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ã†ã“ã¨ã§ã€1 åˆ†ä»¥å†…ã§ä¾å­˜è§£æ±ºã§ãã‚‹æ§˜ã«ãªã‚Šã¾ã—ãŸã€‚</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nb">cd</span> /usr/local <span class="o">&amp;&amp;</span> <span class="se">\</span>
curl <span class="nt">-o</span> HomebrewCellar.tgz https://<span class="nv">$S3_BUCKET</span>.s3.amazonaws.com/HomebrewCellar.tgz <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">tar </span>xvfz HomebrewCellar.tgz
brew <span class="nb">link</span> <span class="nt">--force</span> <span class="k">$(</span>brew list | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s/ruby20//g'</span><span class="k">)</span>
<span class="nb">export </span><span class="nv">S</span><span class="o">=</span><span class="s1">'if which nodenv &gt; /dev/null; then eval "$(nodenv init -)"; fi'</span>
<span class="nb">echo</span> <span class="nv">$S</span> <span class="o">&gt;&gt;</span> ~/.bash_profile
<span class="nb">cd</span> /usr/local <span class="o">&amp;&amp;</span> curl <span class="nt">-o</span> nodenv.tgz https://<span class="nv">$S3_BUCKET</span>.s3.amazonaws.com/nodenv.tgz <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">tar </span>xvfz nodenv.tgz <span class="o">&amp;&amp;</span> node <span class="nt">-v</span> <span class="o">&amp;&amp;</span> npm <span class="nt">-v</span>
</code></pre></div>
<h4 id="4-3">4.3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ³ãƒ‰ãƒ«ã®ä½œæˆ</h4>

<p><a href="https://github.com/maxogden/electron-packager">electron-packager</a> ã¨ã„ã† npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã„ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ³ãƒ‰ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">BUNDLE_ID_PREFIX</span><span class="o">=</span>io.one-team
<span class="nv">VERSION</span><span class="o">=</span><span class="k">$(</span>node <span class="nt">-e</span> <span class="s1">'process.stdout.write(require("./app/package.json").version)'</span><span class="k">)</span>
<span class="c"># Mac</span>
electron-packager ./app Oneteam <span class="se">\</span>
  <span class="nt">--out</span> build <span class="se">\</span>
  <span class="nt">--platform</span><span class="o">=</span>darwin <span class="nt">--arch</span><span class="o">=</span>x64 <span class="se">\</span>
  <span class="nt">--version</span><span class="o">=</span><span class="nv">$ELECTRON_VERSION</span> <span class="se">\</span>
  <span class="nt">--build-version</span><span class="o">=</span><span class="nv">$BUILD_NUM</span> <span class="se">\</span>
  <span class="nt">--app-bundle-id</span><span class="o">=</span><span class="nv">$BUNDLE_ID_PREFIX</span>.Oneteam <span class="se">\</span>
  <span class="nt">--app-version</span><span class="o">=</span><span class="nv">$VERSION</span> <span class="se">\</span>
  <span class="nt">--asar</span> <span class="se">\</span>
  <span class="nt">--helper-bundle-id</span><span class="o">=</span><span class="nv">$BUNDLE_ID_PREFIX</span>.OneteamHelper <span class="se">\</span>
  <span class="nt">--icon</span><span class="o">=</span>assets/osx/app.icns <span class="se">\</span>
  <span class="nt">--overwrite</span> <span class="se">\</span>
  <span class="nt">--sign</span> <span class="s1">'Developer ID Application: Oneteam Inc. (579B4336F6)'</span>
<span class="c"># Windows</span>
electron-packager ./app Oneteam <span class="se">\</span>
  <span class="nt">--out</span> build <span class="se">\</span>
  <span class="nt">--platform</span><span class="o">=</span>win32 <span class="nt">--arch</span><span class="o">=</span>ia32 <span class="se">\</span>
  <span class="nt">--version</span><span class="o">=</span><span class="nv">$ELECTRON_VERSION</span> <span class="se">\</span>
  <span class="nt">--asar</span> <span class="se">\</span>
  <span class="nt">--icon</span><span class="o">=</span>assets/win/app.ico <span class="se">\</span>
  <span class="nt">--overwrite</span> <span class="se">\</span>
  <span class="nt">--version-string</span><span class="o">=</span><span class="nv">$VERSION</span>
</code></pre></div>
<h4 id="4-4">4.4. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ä½œæˆ</h4>

<p><a href="https://github.com/loopline-systems/electron-builder">electron-builder</a> ã¨ã„ã† npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã„ã€Mac ç”¨ã® Disk Image ã¨ Windows ç”¨ã® Installer å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<p>ãƒã‚¦ãƒ³ãƒˆã—ãŸãƒ‡ã‚£ã‚¹ã‚¯ã®èƒŒæ™¯ç”»åƒã‚„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãªã©ãŒç°¡å˜ã«è¡Œãˆã‚‹ã®ã§ã€ãŠã™ã™ã‚ã§ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code>electron-builder build/Oneteam-darwin-x64/Oneteam.app <span class="se">\</span>
  <span class="nt">--platform</span><span class="o">=</span>osx <span class="nt">--out</span><span class="o">=</span><span class="nv">$DIR</span> <span class="nt">--config</span><span class="o">=</span>packager.json

electron-builder build/Oneteam-win32-ia32 <span class="se">\</span>
  <span class="nt">--platform</span><span class="o">=</span>win <span class="nt">--out</span><span class="o">=</span><span class="nv">$DIR</span> <span class="nt">--config</span><span class="o">=</span>packager.json
</code></pre></div>
<p>packager.json</p>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"osx"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Oneteam"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"background"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assets/osx/installer.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assets/osx/mount.icns"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"icon-size"</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w">
    </span><span class="s2">"contents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="s2">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">488</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">264</span><span class="p">,</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="s2">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/Applications"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="s2">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">212</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">264</span><span class="p">,</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"win"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Oneteam"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assets/win/app.ico"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><amp-img src="/images/2016-02-11-how-oneteam-deliver/mounted.png" layout="responsive" width="992" height="671"></amp-img></p>

<h4 id="4-5-chat-room">4.5. Chat Room ã«é€šçŸ¥</h4>

<p>æœ€å¾Œã«ã€æˆæœç‰©ã‚’ Amazon S3 ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ãã® URL ã‚’ Chat Room ã«é€šçŸ¥ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code>aws s3 <span class="nb">sync </span>dist <span class="se">\</span>
  <span class="s2">"s3://</span><span class="nv">$S3BUCKET</span><span class="s2">/desktop/</span><span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span><span class="s2">/b</span><span class="k">${</span><span class="nv">BUILD_NUM</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--acl</span> public-read

curl <span class="nt">-X</span> POST <span class="nt">--data-urlencode</span> <span class="s2">"payload={ ... }"</span> <span class="se">\</span>
  <span class="nv">$SLACK_WEBHOOK_URL</span>
</code></pre></div>
<p>ç¾åœ¨ã€å¼Šç¤¾ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¯ Bot é€£æºã«å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚ã€Slack ã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€ç¾åœ¨ Bot ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é–‹ç™ºã—ã¦ã„ã‚‹ã®ã§ã€è¿‘ã€…ã€è‡ªç¤¾è£½å“ã§å®Œçµã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<h2 id="todos">TODOs</h2>

<p>ä¸Šè¨˜ã®æ§˜ã«ã€ã„ã‚ã„ã‚é ‘å¼µã£ã¦è‡ªå‹•åŒ–ã—ã¦ã„ã¾ã™ãŒã€ã¾ã æœªå¯¾å¿œã®ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚</p>

<h3 id="windows">Windows ç”¨ã®è¨¼æ˜æ›¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>

<p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa387764(v=vs.85).aspx">SignTool</a> ã‚’ä½¿ã£ã¦ã€Windows ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã«ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ãƒ³ã‚’è¡Œã‚ãªã„ã¨ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã€ä¸æ˜ãªé–‹ç™ºè€…ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã ã¨èªè­˜ã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è­¦å‘ŠãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p>

<p>ä»Šã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹ä½œæ¥­ã§è¡Œã„ã€é…å¸ƒå…ƒã®ãƒ›ã‚¹ãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight plaintext"><code>C:\"Program Files (x86)"\"Windows Kits"\10\bin\x86\signtool.exe `
  sign /f oneteam-installer.pfx `
  /p naisho `
  /d "Oneteam Installer" `
  /t http://timestamp.comodoca.com/authenticode `
  "Oneteam Setup.exe"
</code></pre></div>
<h3 id="auto-updater">Auto Updater ã®è¨­å®š</h3>

<p><a href="https://github.com/GitbookIO/nuts">Nuts</a> ã¨ã„ã†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ¼ãƒ‰é…ä¿¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é››å½¢ã‚’å…ƒã«ã€Electron ã® <a href="http://electron.atom.io/docs/latest/api/auto-updater/">Auto Updater</a> ã®ä»•çµ„ã¿ã‚’ä½¿ã£ãŸ Heroku ä¸Šã§å‹•ä½œã™ã‚‹æ§˜ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸã®ã§ã™ãŒã€Electron ã‚¢ãƒ—ãƒªå´ã§ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å—ä¿¡å¾Œã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¦ã—ã¾ã†å•é¡Œã«ã¶ã¤ã‹ã‚Šã€å¡©æ¼¬ã‘ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>
<div class="highlight"><pre class="highlight shell"><code><span class="c">#!/bin/bash</span>

<span class="nb">set</span> <span class="nt">-eu</span>

<span class="nv">VERSION</span><span class="o">=</span><span class="k">$(</span>node <span class="nt">-e</span> <span class="s2">"process.stdout.write(require('./app/package.json').version)"</span><span class="k">)</span>
<span class="nv">BUILD_NUM</span><span class="o">=</span><span class="k">$(</span>node <span class="nt">-e</span> <span class="s2">"process.stdout.write(require('./app/package.json').buildNumber)"</span><span class="k">)</span>

heroku config:set <span class="se">\</span>
  <span class="nv">LATEST_VERSION</span><span class="o">=</span><span class="nv">$VERSION</span> <span class="se">\</span>
  <span class="nv">LATEST_ZIP_URL</span><span class="o">=</span>https://<span class="nv">$S3_BUCKET</span>/desktop/<span class="nv">$VERSION</span>/b<span class="nv">$BUILD_NUM</span>/osx/Oneteam.zip <span class="se">\</span>
  <span class="nt">--app</span> <span class="nv">$NUTS_HEROKU_APP</span>
</code></pre></div>
<p>ã¾ãŸã€Mac AppStore ã§ã®é…ä¿¡ã‚‚æ¤œè¨ã—ã¦ã„ã‚‹ã®ã§ã€ãã®éš›ã«ã¯ã€iTunes Connect ã¸ã®é…ä¿¡ä½œæ¥­ã‚‚è‡ªå‹•åŒ–ã—ã‚ˆã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p>

<h2 id="part-2d58fd6afcd8d787">ç™ºè¡¨è³‡æ–™</h2>

<div id="embed-slide"></div>

<h2 id="were-hiring">We&rsquo;re HIRING!</h2>

<p>æœ€å¾Œã«ã€å®£ä¼ã§ç”³ã—è¨³ãªã„ã§ã™ãŒã€ã“ã‚“ãªé¢¨ã«ã€é–‹ç™ºãƒ•ãƒ­ãƒ¼ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã® UX ã«ã“ã ã‚ã‚Šã‚’æŒã£ã¦ä¸€ç·’ã«é–‹ç™ºã—ã¦ã„ãŸã ã‘ã‚‹ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’çµ¶è³›æ¡ç”¨ä¸­ãªã®ã§ã€ã‚‚ã—èˆˆå‘³ãŒã‚ã‚‹æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã„ã¾ã—ãŸã‚‰ã€ä»¥ä¸‹ã®æ¡ç”¨ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ã„ãŸã ãã€é€£çµ¡ã„ãŸã ã‘ã‚‹ã¨ã¨ã¦ã‚‚ã†ã‚Œã—ã„ã§ã™ ğŸ™</p>

<p><a href="https://one-team.com/ja/recruit/">https://one-team.com/ja/recruit/</a></p>

    </article>
  </body>
</html>
